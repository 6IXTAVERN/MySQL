<h1 align="center"><a href=""><img src="https://github.com/6IXTAVERN/MySQL/assets/116119822/2c2fe8b2-aba7-4fb0-bc48-6899135c5613" width="20" height="20"/></a> MySQL</h1>

<p align="center">
  <a href="#-lab1"><img alt="lab1" src="https://img.shields.io/badge/Lab1-blue"></a> 
  <a href="#-lab2"><img alt="lab2" src="https://img.shields.io/badge/Lab2-red"></a>
  <a href="#-lab31"><img alt="lab3.1" src="https://img.shields.io/badge/1-383838?label=Lab3&labelColor=8A2BE2"></a>
  <a href="#-lab32"><img alt="lab3.2" src="https://img.shields.io/badge/2-383838?label=Lab3&labelColor=8A2BE2"></a>
  <a href="#-lab5"><img alt="lab5" src="https://img.shields.io/badge/Lab5-green"></a>
  <a href="#-lab6"><img alt="lab6" src="https://img.shields.io/badge/Lab6-yellow"></a>
  <a href="#-lab7"><img alt="lab7" src="https://img.shields.io/badge/Lab7-gray"></a>
</p>

# <img src="https://github.com/6IXTAVERN/MySQL/assets/116119822/2c2fe8b2-aba7-4fb0-bc48-6899135c5613" width="20" height="20"/> Lab1
<h3 align="center">
  <a href="#er-model"></a>
  ER модель
</h3>
<p align="center">
  <img alt="ER model" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/6f2c9756-b4c0-4beb-b64f-a46ad71dddc6"> 
</p>

<h3 align="center">
  <a href="#relational-model"></a>
  Реляционная модель
</h3>
<p align="center">
  <img alt="Relational model" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/68b31c0b-2fe4-422c-af63-a3adf6b76956"> 
</p>


# <img src="https://github.com/6IXTAVERN/MySQL/assets/116119822/2c2fe8b2-aba7-4fb0-bc48-6899135c5613" width="20" height="20"/> Lab2
Скрипт для создания таблиц(Script.sql) + команды для выполнения(PushTables.sql) хранятся в Lab2

<h3 align="center">
  <a href="#client"></a>
  Таблица "client"
</h3>
<p align="center">
  <img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/29365308-7e08-4309-90b3-bb3431489e97"> 
</p>

<h3 align="center">
  <a href="#comfortable"></a>
  Таблица "comfortable"
</h3>
<p align="center">
  <img alt="comfortable" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/ec3959fd-f5b7-48a3-bc2c-5955b500a8ee"> 
</p>

<h3 align="center">
  <a href="#living"></a>
  Таблица "living"
</h3>
<p align="center">
  <img alt="living" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/400177e6-17ab-4818-b460-f1f5fb25edae"> 
</p>

<h3 align="center">
  <a href="#reservation"></a>
  Таблица "reservation"
</h3>
<p align="center">
  <img alt="reservation" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/9e0ddafd-81b5-4875-8adf-9a82035aad50"> 
</p>

<h3 align="center">
  <a href="#room"></a>
  Таблица "room"
</h3>
<p align="center">
  <img alt="room" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/482296d3-7766-4282-afb2-a79fe97d1156"> 
</p>


# <img src="https://github.com/6IXTAVERN/MySQL/assets/116119822/2c2fe8b2-aba7-4fb0-bc48-6899135c5613" width="20" height="20"/> Lab3.1
<h3 align="center">
  <a href="#client"></a>
  1.1 Выборка и сортировка таблиц
</h3>
<p align="center"><i>Сортировка клиентов по возрастанию ASC ФИО</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/7ebf4385-e50d-4731-bafc-e48b01cd7f9a">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/4edb6e78-e344-4382-98a6-e19833cf8ac7"> 

<p align="center"><i>Сортировка брони по убыванию даты запланированного приезда</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/72d93cb1-d525-46a6-9dc8-54e3b85568ba">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/8599cbf0-8251-485e-949f-417ceb71ffc9"> 


<h3 align="center">
  <a href="#client"></a>
  1.2 Выборка с условием отбора(WHERE)
</h3>
<p align="center"><i>Выбор номеров, находящихся на 1 этаже</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/78c4f07e-8e90-4ff5-bc6f-c55a038e20cc">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/14408e1d-0aa9-4483-a134-ebdf8763c5ba"> 

<p align="center"><i>Выбор номеров, находящихся на 2 этаже</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/44b4104d-aef8-4eaf-8925-e5428827872f">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/1ca6d584-03fd-42c3-9b52-baf1522836d2"> 

<p align="center"><i>Выбор брони, включающей в себя питание + заселение по которой запланировано не позднее 19 октября 2022 года</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/7034f359-ce94-4dc7-84a6-b00dcc33f7eb">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/8b0de04e-c2cd-464a-b2b9-a65f395ab85d"> 


<h3 align="center">
  <a href="#client"></a>
  1.3 Использование агрегатных функций с группировкой и без
</h3>
<p align="center"><i>Найти количество номеров</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/109075a5-4811-4d60-a763-8c239f1b4030">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/0a226423-e6c9-46f5-85a0-324cd202e72e"> 

<p align="center"><i>Найти количество номеров(группировка по этажам)</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/baa752c7-8e2c-41f1-8544-0b21b0a54c05">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/1bdafa35-ebf4-4c8a-970f-3ba203daa87b"> 

<p align="center"><i>Найти цену самого дорогостоящего типа комфортности номера</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/2cbafad2-4109-422e-bb8e-da932cfdc926">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/4b3fb3fd-d4eb-4c82-8ebf-c5d9e89e317d"> 

<p align="center"><i>Найти бронь с самым поздним назначенным заездом(группировка по наличию питания)</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/f3282b63-3ade-46e0-ad60-0bc3c6299d2c">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/55860167-93eb-42f6-b60c-9c46748f6889"> 


<h3 align="center">
  <a href="#client"></a>
  1.4 Подведения подытога с использованием GROUP BY и параметров
</h3>
<p align="center"><i>Найти количество комнат определенного типа комфортности на каждом этаже, а также подвести итог с общим их количеством (WITH ROLLUP)</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/accf237a-b9f1-401e-b802-927eb1be30aa">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/a5c3c163-1560-4562-a241-5888b553e6a4"> 

<p align="center"><i>Вывести количество броней для каждого клиента, учитывая тип комфортности. Подвести итоги группировкой по всем возможным комбинациям (кастомный параметр CUBE из MSSQL)</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/e734a3e5-5fe3-4596-b37b-32248ee184bc">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/17bff6e9-f000-43b9-9a93-e6dca050b4da"> 


<h3 align="center">
  <a href="#client"></a>
  1.5 Выборка с помощью заданных последовательностей символов(LIKE)
</h3>
<p align="center"><i>Найти всех клиентов, у которых паспорт заканчивается не на цифру 1</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/d7cb967d-7e6c-4a85-a814-7497779d5dbb">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/e7dfd897-d771-4797-bafe-da8cda1fbc3f"> 

<p align="center"><i>Найти всех клиентов, у которых в ФИО нет подстроки ‘ович’</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/4d1113b2-34a6-45af-8af4-cf2046e5c620">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/968a02a0-7e05-47ea-95a6-c68fda1ef9bd"> 


<h3 align="center">
  <a href="#client"></a>
  2.1 Классический подход соединения таблиц(WHERE)
</h3>
<p align="center"><i>Вывести для каждой брони ФИО клиента</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/d84c8ef5-13b4-41e5-9998-a4e0f6692265">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/72edf423-1535-4844-872e-f5c2f4c11572"> 

<p align="center"><i>Вывести для каждого проживания дату заезда согласно бронированию</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/64212fe0-8112-486d-b38b-3aca25c3e6ce">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/0a8929ff-2c6e-4a47-bd01-739cccb8f719"> 


<h3 align="center">
  <a href="#client"></a>
  2.2 Внутреннее соединение таблиц(INNER JOIN)
</h3>
<p align="center"><i>Вывести для каждой брони ФИО клиента</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/40447d06-fc2d-4dc8-9bee-8cab49aa2141">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/ec1aa262-ecea-447f-a110-4d561c3cd295"> 

<p align="center"><i>Вывести для каждого проживания дату заезда согласно бронированию</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/5d7546e2-1ca9-4690-8406-36c2a8aafc88">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/0e9e2d65-5851-43a0-970a-d8ab9818b272"> 


<h3 align="center">
  <a href="#client"></a>
  2.3 Левое внешнее соединение таблиц(LEFT OUTER JOIN)
</h3>
<p align="center"><i>Вывести для каждого клиента id его брони</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/290147fa-7ec1-4fe2-94be-9bbffe9c57f7">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/689fe4cb-59e2-442e-bf07-8d7d65317fa9"> 

<p align="center"><i>Вывести для каждого типа комфортности соответствующие брони</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/6b5dea6a-e4a2-47aa-af21-c5db8ecec6b4">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/7c33b405-845e-4e60-bd29-1730fec7de8d">


<h3 align="center">
  <a href="#client"></a>
  2.4 Правое внешнее соединение таблиц(RIGHT OUTER JOIN)
</h3>
<p align="center"><i>Вывести для каждого клиента id его брони</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/fcbbb1fb-7ab0-4e2b-97cb-6937c3ec0fb8">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/55863392-9c29-4e30-9c36-8593230dcf25"> 

<p align="center"><i>Вывести для каждого типа комфортности соответствующие брони</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/8a5105b1-bd00-45e4-816a-cb2205674c30">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/8246bc5a-3d65-4eba-99f8-16e4d4c949ce">


<h3 align="center">
  <a href="#client"></a>
  2.5 Агрегатные функции + группировка
</h3>
<p align="center"><i>Вывести минимальную стоимость номера на каждом этаже</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/46efc5b9-2ae4-4a64-b431-3af8252183ab">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/88cf365f-4df5-4d26-bfd4-a6c9f19050f2"> 

<p align="center"><i>Вывести среднюю стоимость номера на каждом этаже</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/c5ebf36d-0c94-4294-8426-3a87a59898a2">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/5cd530ad-ddf7-4b9e-bfb6-7ef424b17ab0">


<h3 align="center">
  <a href="#client"></a>
  2.6 Условие отбора групп(HAVING) + группировка
</h3>
<p align="center"><i>Выбрать этажи, на которых 3 и более комнат</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/1ed11460-10d8-4b8f-8e12-ed4a34ad6305">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/ef76a467-62bf-4bb4-b8f7-edaa851b81ce"> 

<p align="center"><i>Выбрать клиентов, у которых ровно 1 бронь</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/b2b4645a-75f7-43e3-bd87-aed0a65360e4">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/94305c76-3b97-48ec-af94-8aaeb92c6424">


<h3 align="center">
  <a href="#client"></a>
  2.7 Использование IN, EXISTS
</h3>
<p align="center"><i>Выбрать клиентов, у которых существует бронь</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/74e661a3-2c16-4828-8e3a-6035fa6bdb09">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/8516929b-74d7-44a9-b996-d55da7db47c0"> 

<p align="center"><i>Выбрать клиентов, у которых дата заселения в какой-либо брони назначена на 5 мая 2023 года 21:00 или 15 мая 2023 года 10:00</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/675e189f-9ce0-41d1-90d7-781b62d9bcd1">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/37e41bb0-0eb6-420a-9f54-4409f775c0e9">

<p align="center"><i>Выбрать типы комфортности номеров, которые существуют на данный момент в отеле (прим. номера с президентским люксом подготавливаются службой отеля, но пока таковых нет)</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/aa22c92f-9af1-42ee-adb7-311f51d147d5">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/15caac2d-34e8-4783-b951-30ec1c4082d3">

<h3 align="center">
  <a href="#client"></a>
  3.1 Создание представлений(VIEW)
</h3>
<p align="center"><i>Представление на основе -> [1.2.6 Выбрать этажи, на которых 3 и более комнат]</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/c7987086-be59-42f9-9564-6f7e26dc205c">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/fb7bb475-f487-4a37-8b8d-0e6ebda10622"> 

<p align="center"><i>Представление на основе -> [1.2.6 Выбрать клиентов, у которых ровно 1 бронь]</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/ab68d6ee-c29a-4cdd-bb40-c6f7e06526e6">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/26f716b2-577c-43c0-a67f-05825752c457">


<h3 align="center">
  <a href="#client"></a>
  3.2 Использование общетабличных выражений (СТЕ)
</h3>
<p align="center"><i>Подсчитать общую стоимость дневной аренды всех номеров каждого типа</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/1e421016-0435-4808-a25e-350efea51f91">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/3e93c907-ea99-4aeb-adb4-6b39d9fbe61d"> 

<p align="center"><i>Вывести среднюю цену номера на этаже</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/e0ce57bc-5b31-4ad9-a97a-eb349c21c843">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/17bde8f5-2d01-4f28-b485-108ba7c0a025">


<h3 align="center">
  <a href="#client"></a>
  4.1 Функции ранжирования(ROW_NUMBER, RANK, DENSE_RANK) [PARTITION BY]
</h3>
<p align="center"><i>Вывести и пронумеровать все типы номеров и id соответствующим им номеров</i>
<p align="center"><i>ROW_NUMBER</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/2fe4ca85-9d33-412d-8d03-af30bd0ebfe3">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/4674e45a-d1d9-44df-a9b4-408cc5d99a00"> 

<p align="center"><i>ROW_NUMBER + PARTITION BY</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/54217e49-38db-4369-a15d-de8c4ac9fe39">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/69aa24cb-ab27-45b2-b236-abb90ebd6f88">

<p align="center"><i>RANK</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/d9e1ceb8-a921-4f37-9b65-00f58c7af335">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/440e6daa-1b87-46de-8d3a-572d3b1a1eb7"> 

<p align="center"><i>DENSE_RANK</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/6e092cd2-f671-4577-af4d-3e064e1c4726">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/d60fce4c-ff38-4c4c-9cc7-258e175f2103"> 


<h3 align="center">
  <a href="#client"></a>
  5.1 Объединение, пересечение, разность(UNION, EXCEPT, INTERSECT)
</h3>
<p align="center"><i>Вывести все номера типа 'Бизнес' находящиеся на 1 этаже и типа 'Эконом' на 3</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/906a7824-e4df-440e-a293-6acd85b7e006">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/2e9c481f-ecd5-4b1b-a75d-9c25280b0022"> 

<p align="center"><i>Вывести все номера с типом 'Обычный', находящиеся на 2 этаже</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/f048041b-340b-4b9a-987d-944aea891440">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/7f7b223d-bb83-485e-af09-e6c82a14c6cc">

<p align="center"><i>Вывести все номера, за исключением тех, что располагаются на 2 этаже с возрастающей сортировкой по этажам</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/38c68082-e86c-495b-a075-ca9f08bb1956">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/07699381-1d14-4bff-82fa-58068beea0f6">


<h3 align="center">
  <a href="#client"></a>
  6.1 Использование CASE
</h3>
<p align="center"><i>Вывести для каждого человека тип номера, забронированный им. Если ни одного номера нет, вернуть 'Нет забронированных номеров'</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/57b8347f-d0f5-4281-ac09-47c2f8c01d6e">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/d6bdaf47-23c5-47c9-beb8-5e1b8c572bd8"> 

<p align="center"><i>Вывести, сколько раз на каждый из дней недели выпадало заселение согласно броне</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/e3eb46a9-aa8a-46c7-9ea5-69b2b82f2324">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/3a5c5cff-6a49-41e2-8040-c581664a4b80">

# <img src="https://github.com/6IXTAVERN/MySQL/assets/116119822/2c2fe8b2-aba7-4fb0-bc48-6899135c5613" width="20" height="20"/> Lab3.2
<h3 align="center">
  <a href="#client"></a>
  2.a Найти номера, не занятые и не забронированные на данный момент
</h3>
<p align="center"><i>Для тестирования добавил следующее(момент выполнения задания 23.12.2023 выпадает на созданную бронь, прикрепленную к номеру 3)</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/f2c20aa0-547b-4e95-af4f-31154eaae502">
  
<p align="center"><i>Сам запрос</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/d2da94e2-684a-4dc7-b80c-425b47d3d329">

<p align="center"><i>Как видим, номер с идентификатором 3 отсутствует в конечной выборке</i>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/cb1a4f53-6807-4246-b0af-3a088ed732b1"> 


<h3 align="center">
  <a href="#client"></a>
  2.b Найти клиентов, выехавших из номера раньше срока, указанного в договоре
</h3>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/804d7f0e-092c-4d15-952a-9a3b8fb9511a">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/63544859-8d0f-4c29-97b1-5755d65c5f70">


<h3 align="center">
  <a href="#client"></a>
  2.c Найти номера, которые ни разу не сдавались с начала текущего года
</h3>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/d704b82a-608e-4aef-b747-2217051c00c1">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/592c30ab-b9d2-4386-812e-6f2f06149f6f">


<h3 align="center">
  <a href="#client"></a>
  2.d Найти клиентов, забронировавших номер, но так и не въехавших в него
</h3>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/ecb9b4bc-a39f-444b-bd3b-475738a6b025">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/d0548614-5c5c-4d89-9bb5-6b052d8cefb7">


<h3 align="center">
  <a href="#client"></a>
  2.e Среди всех клиентов, наиболее часто пользующихся услугами гостиницы, найти клиентов с максимальным сроком проживания
</h3>
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/537c3bd5-7924-44a2-93bd-bdb90352c56c">
<p align="center"><img alt="client" src="https://github.com/6IXTAVERN/MySQL/assets/116119822/adf487b7-b1ab-47b1-a3e6-c6c0d8b88412">


# <img src="https://github.com/6IXTAVERN/MySQL/assets/116119822/2c2fe8b2-aba7-4fb0-bc48-6899135c5613" width="20" height="20"/> Lab5
<h3 align="center">
  <a href="#client"></a>
  5.a Триггер на добавление брони – если дата заезда больше текущей на 6 месяцев – цена на такую бронь увеличивается на 10%
</h3>

```mysql
# Помимо процента, в этом триггере рассчитывается цена с учетом питания, времени проживания и комфортности
CREATE TRIGGER SetReservationPrice
BEFORE INSERT ON Reservation
FOR EACH ROW
BEGIN
  DECLARE _price DECIMAL(10, 2);
  DECLARE _days INT;
  DECLARE _day_nutrition_price INT;

  SET _day_nutrition_price = 10000;
  SET _days = DATEDIFF(NEW.date_leaving, NEW.date_arrival);
  SET _price = (SELECT price
                FROM Comfortable
                WHERE id_comfortable = NEW.id_comfortable) * _days;

  IF NEW.date_arrival > DATE_ADD(CURDATE(), INTERVAL 6 MONTH) THEN
    SET _price = _price * 1.1;
  END IF;

  # Стоимость питания не зависит от времени брони
  IF NEW.nutrition = 1 THEN
    SET _price = _price + _days * _day_nutrition_price;
  END IF;

  SET NEW.ovr_price = _price;
END;
```

Попробую добавить несколько записей в таблицу бронирования:
```mysql
INSERT INTO Reservation (id_living, id_client, id_comfortable, date_arrival, date_leaving, nutrition, ovr_price)
VALUES (16, 1, 1, '2024-12-05', '2024-12-15', 1, 0),
       (17, 2, 2, '2024-05-10', '2024-05-15', 0, 0),
       (18, 3, 3, '2024-08-20', '2024-08-25', 0, 0);
```

Цена добавляемых данных была правильно модифицирована. Например, бронь с идентификатором 28:  
(10 дней проживания * 25.000(фиксированная стоимость номера бизнес класса за день)) * 1.1 + 10 * 10.000(фиксированная стоимость питания за день) = 375000
| id_reservation | id_client | id_comfortable | id_living | date_arrival        | date_leaving        | nutrition | ovr_price |
|----------------|-----------|----------------|-----------|---------------------|---------------------|-----------|-----------|
| 28             | 1         | 1              | 16        | 2024-12-05 00:00:00 | 2024-12-15 00:00:00 | 1         | 375000    |
| 29             | 2         | 2              | 17        | 2024-05-10 00:00:00 | 2024-05-15 00:00:00 | 0         | 75000     |
| 30             | 3         | 3              | 18        | 2024-08-20 00:00:00 | 2024-08-25 00:00:00 | 0         | 25000     |

<h3 align="center">
  <a href="#client"></a>
  5.b Последующий триггер на изменение питания – клиент может передумать и отказаться от питания, либо же наоборот захочет включить его в свою бронь. Нужно пересчитать общую стоимость проживания по броне в зависимости от решения клиента.
</h3>

```mysql
CREATE TRIGGER UpdateNutrition
BEFORE UPDATE ON Reservation
FOR EACH ROW
BEGIN
    DECLARE _day_nutrition_price INT;
    SET _day_nutrition_price = 10000;

    IF NEW.nutrition <> OLD.nutrition THEN
        IF NEW.nutrition = 1 THEN
            SET NEW.ovr_price = NEW.ovr_price + DATEDIFF(NEW.date_leaving, NEW.date_arrival) * _day_nutrition_price;
        ELSE
            SET NEW.ovr_price = NEW.ovr_price - DATEDIFF(NEW.date_leaving, NEW.date_arrival) * _day_nutrition_price;
        END IF;
    END IF;
END;
```

Попробую изменить бронь с идентификатором 29 - пусть клиент решил, что хочет включить питание в бронь
```mysql
# Вид брони с идентификатором 29 до следующей операции можно увидеть в задании выше
UPDATE Reservation
SET nutrition = 1
WHERE id_reservation = 29;
```

Цена по данной брони была перерасчитана:
| id_reservation | id_client | id_comfortable | id_living | date_arrival        | date_leaving        | nutrition | ovr_price |
|----------------|-----------|----------------|-----------|---------------------|---------------------|-----------|-----------|
| 29             | 2         | 2              | 17        | 2024-05-10 00:00:00 | 2024-05-15 00:00:00 | 1         | 125000    |

<h3 align="center">
  <a href="#client"></a>
  5.с Замещающий триггер на операцию удаления номера из списка номеров – если номер на данный момент занят, то не удаляем его, выводим сообщение о невозможности удаления; если не занят – удаляем его и всю информацию о его сдаче и бронировании
</h3>

```mysql
# Замечание: в MySQL нет так называемых "замещающих триггеров", как в MS - однако, можно пользоваться BEFORE DELETE
# Комментарий по заданию: если есть запись в таблице living для данного room,
# и у этой записи living в промежуток проживания попадает нынешнее время, то запрет на удаление.
# Еще возможна ситуация, что date_arrival задан, а date_leaving является NULL - значит на данный момент
# в номере проживают, тоже нужно блокировать удаление.
CREATE TRIGGER DeleteRoom
BEFORE DELETE ON Room
FOR EACH ROW
BEGIN
    DECLARE room_occupied INT;
    SELECT COUNT(*)
    INTO room_occupied
    FROM Living
    WHERE id_room = OLD.id_room
      AND (factually_arrive <= NOW() AND (factually_leaving >= NOW() OR factually_leaving IS NULL));

    IF room_occupied > 0 THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Невозможно удалить: номер занят';
    ELSE
        DELETE
        FROM Reservation
        WHERE id_living IN (SELECT id_living
                            FROM Living
                            WHERE id_room = OLD.id_room);
        DELETE FROM Living WHERE id_room = OLD.id_room;
    END IF;
END;
```

Чтобы проверить данный триггер, добавлю следующую строку в таблицу проживания
| id_living | id_room | factually_arrive    | factually_leaving   |
|-----------|---------|---------------------|---------------------|
| 19        | 4       | 2024-04-10 08:00:00 | NULL                |

Теперь попробую удалить номер с идентификатором 4, в котором, по новым данным, кто-то проживает(сегодня 16.04.2024)
```mysql
DELETE FROM Room
WHERE id_room = 4;
```

Получаю следующую ошибку:
```mysql
[45000][1644] Невозможно удалить: номер занят
```

Также попробую удалить номер, который на данный момент не занят. В нынешней ситуации это любой, кроме 4ого. Пусть будет 1ый:
```mysql
DELETE FROM Room
WHERE id_room = 1;
```

Номер удалился, а данные о нем очистились. В качестве результата покажу таблицы Room, Living и Reservation:
## Room
| id\_room | id\_comfortable | floor |
| :--- | :--- | :--- |
| 2 | 2 | 2 |
| 3 | 3 | 4 |
| 4 | 3 | 4 |
| 5 | 2 | 2 |
| 6 | 1 | 2 |
| 7 | 1 | 1 |
| 8 | 3 | 3 |
| 9 | 2 | 2 |
| 10 | 2 | 1 |
| 11 | 2 | 1 |

## Living
| id\_living | id\_room | factually\_arrive | factually\_leaving |
| :--- | :--- | :--- | :--- |
| 3 | 3 | 2023-04-03 18:00:00 | 2023-04-06 13:00:00 |
| 4 | 4 | 2022-02-02 10:00:00 | 2022-02-10 12:00:00 |
| 5 | 5 | null | null |
| 6 | 6 | 2021-01-02 09:00:00 | 2021-02-03 10:00:00 |
| 7 | 7 | 2020-12-01 11:00:00 | 2020-12-05 11:00:00 |
| 8 | 8 | 2019-12-03 12:00:00 | 2019-12-05 13:00:00 |
| 9 | 9 | 2020-01-12 11:00:00 | 2020-01-13 13:00:00 |
| 10 | 10 | 2018-03-03 10:00:00 | 2018-03-05 10:00:00 |
| 11 | 3 | 2023-12-14 20:00:00 | 2023-12-25 19:00:00 |
| 12 | 3 | 2023-12-14 20:00:00 | 2023-12-25 19:00:00 |
| 13 | 5 | null | null |
| 15 | 2 | 2023-08-01 22:00:00 | 2023-08-29 19:00:00 |
| 17 | 2 | null | null |
| 18 | 3 | null | null |
| 19 | 4 | 2024-04-10 08:00:00 | null |

## Reservation
| id\_reservation | id\_client | id\_comfortable | id\_living | date\_arrival | date\_leaving | nutrition | ovr\_price |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 3 | 2 | 3 | 3 | 2023-04-03 17:00:00 | 2023-04-06 14:00:00 | 1 | 0 |
| 4 | 3 | 3 | 4 | 2022-02-02 10:00:00 | 2022-02-10 12:00:00 | 1 | 0 |
| 5 | 4 | 2 | 5 | 2021-05-06 12:00:00 | 2021-06-06 13:00:00 | 0 | 0 |
| 6 | 4 | 2 | 6 | 2021-01-02 09:00:00 | 2021-02-03 10:00:00 | 0 | 0 |
| 7 | 5 | 1 | 7 | 2020-12-01 11:00:00 | 2020-12-05 11:00:00 | 1 | 0 |
| 8 | 7 | 1 | 8 | 2019-12-03 12:00:00 | 2019-12-05 13:00:00 | 0 | 0 |
| 9 | 9 | 1 | 9 | 2020-01-12 11:00:00 | 2020-01-13 13:00:00 | 1 | 0 |
| 10 | 10 | 2 | 10 | 2018-03-03 10:00:00 | 2018-03-05 10:00:00 | 0 | 0 |
| 11 | 1 | 1 | 11 | 2023-12-13 22:00:00 | 2023-12-27 19:00:00 | 0 | 0 |
| 12 | 2 | 1 | 12 | 2023-12-13 22:00:00 | 2023-12-27 19:00:00 | 0 | 0 |
| 13 | 5 | 2 | 13 | 2023-12-13 22:00:00 | 2023-12-29 19:00:00 | 0 | 0 |
| 15 | 2 | 2 | 15 | 2023-08-01 22:00:00 | 2023-08-29 19:00:00 | 0 | 0 |
| 29 | 2 | 2 | 17 | 2024-05-10 00:00:00 | 2024-05-15 00:00:00 | 1 | 125000 |
| 30 | 3 | 3 | 18 | 2024-08-20 00:00:00 | 2024-08-25 00:00:00 | 0 | 25000 |

# <img src="https://github.com/6IXTAVERN/MySQL/assets/116119822/2c2fe8b2-aba7-4fb0-bc48-6899135c5613" width="20" height="20"/> Lab6
<h3 align="center">
  <a href="#client"></a>
  6.a Роль и пользователь для менеджера
</h3>

```mysql
# Создание роли руководителя
CREATE ROLE RoleManager;
GRANT SELECT, INSERT, DELETE, UPDATE ON mydb.* TO RoleManager;

# Создание пользователя с ролью руководителя
CREATE USER 'UserManager'@`localhost` IDENTIFIED BY 'pass';
GRANT RoleManager TO 'UserManager'@`localhost`;

# Права на процедуры/функции можно выдать только пользователю напрямую
GRANT EXECUTE ON FUNCTION funcA_GetLongestStayingClient TO 'UserManager'@`localhost`;
GRANT EXECUTE ON PROCEDURE proc_getClientsWhereGreaterAvg TO 'UserManager'@`localhost`;

# Обновление ролей
FLUSH PRIVILEGES;
```

Для проверки:

```mysql
SHOW GRANTS FOR RoleManager;
```

| Grants for RoleManager@% |
| :--- |
| GRANT USAGE ON \*.\* TO \`RoleManager\`@\`%\` |
| GRANT SELECT, INSERT, UPDATE, DELETE ON \`mydb\`.\* TO \`RoleManager\`@\`%\` |

```mysql
SHOW GRANTS FOR 'UserManager'@'localhost';
```

| Grants for UserManager@localhost |
| :--- |
| GRANT USAGE ON \*.\* TO \`UserManager\`@\`localhost\` |
| GRANT EXECUTE ON PROCEDURE \`mydb\`.\`proc\_getclientswheregreateravg\` TO \`UserManager\`@\`localhost\` |
| GRANT EXECUTE ON FUNCTION \`mydb\`.\`funca\_getlongeststayingclient\` TO \`UserManager\`@\`localhost\` |
| GRANT \`RoleManager\`@\`%\` TO \`UserManager\`@\`localhost\` |


<h3 align="center">
  <a href="#client"></a>
  6.b Роль и пользователь для сотрудника
</h3>

```mysql
# Создание роли сотрудника
CREATE ROLE RoleEmployee;
GRANT SELECT (id_client, full_name, phone) ON mydb.client TO RoleEmployee;
GRANT SELECT (id_client, date_arrival, date_leaving, nutrition, ovr_price) ON mydb.reservation TO RoleEmployee;

# Создание пользователя с ролью сотрудника
CREATE USER 'UserEmployee'@'localhost' IDENTIFIED BY 'pass';
GRANT RoleEmployee TO 'UserEmployee'@'localhost';

# Обновление ролей
FLUSH PRIVILEGES;
```

Для проверки:

```mysql
SHOW GRANTS FOR RoleEmployee;
```

| Grants for RoleEmployee@% |
| :--- |
| GRANT USAGE ON \*.\* TO \`RoleEmployee\`@\`%\` |
| GRANT SELECT \(\`full\_name\`, \`id\_client\`, \`phone\`\) ON \`mydb\`.\`client\` TO \`RoleEmployee\`@\`%\` |
| GRANT SELECT \(\`date\_arrival\`, \`date\_leaving\`, \`id\_client\`, \`nutrition\`, \`ovr\_price\`\) ON \`mydb\`.\`reservation\` TO \`RoleEmployee\`@\`%\` |


```mysql
SHOW GRANTS FOR 'UserEmployee'@'localhost';
```

| Grants for UserEmployee@localhost |
| :--- |
| GRANT USAGE ON \*.\* TO \`UserEmployee\`@\`localhost\` |
| GRANT \`RoleEmployee\`@\`%\` TO \`UserEmployee\`@\`localhost\` |



## BONUS: права с разрешением передачи прав другому пользователю

Права с разрешением передачи, как и использование процедур/функций, можно передать только конкретному пользователю напрямую:

```mysql
GRANT DELETE ON reservation TO 'UserManager'@`localhost` WITH GRANT OPTION;
```

К правам пользователя UserManager добавилась следующая строка:

| Grants for UserManager@localhost |
| :--- |
| GRANT DELETE ON \`mydb\`.\`reservation\` TO \`UserManager\`@\`localhost\` WITH GRANT OPTION |

Теперь авторизируемся под этим пользователем и проверим выдачу прав:

```mysql
GRANT DELETE ON mydb.reservation TO RoleEmployee;
```

Результат:

| Grants for RoleEmployee@% |
| :--- |
| GRANT USAGE ON \*.\* TO \`RoleEmployee\`@\`%\` |
| GRANT SELECT \(\`full\_name\`, \`id\_client\`, \`phone\`\) ON \`mydb\`.\`client\` TO \`RoleEmployee\`@\`%\` |
| GRANT SELECT \(\`date\_arrival\`, \`date\_leaving\`, \`id\_client\`, \`nutrition\`, \`ovr\_price\`\), DELETE ON \`mydb\`.\`reservation\` TO \`RoleEmployee\`@\`%\` |


Также, с этого пользователя(UserManager) мы можем отозвать выданное разрешение:
```mysql
REVOKE DELETE ON mydb.reservation FROM RoleEmployee;
```

Результат:

| Grants for RoleEmployee@% |
| :--- |
| GRANT USAGE ON \*.\* TO \`RoleEmployee\`@\`%\` |
| GRANT SELECT \(\`full\_name\`, \`id\_client\`, \`phone\`\) ON \`mydb\`.\`client\` TO \`RoleEmployee\`@\`%\` |
| GRANT SELECT \(\`date\_arrival\`, \`date\_leaving\`, \`id\_client\`, \`nutrition\`, \`ovr\_price\`\) ON \`mydb\`.\`reservation\` TO \`RoleEmployee\`@\`%\` |


# <img src="https://github.com/6IXTAVERN/MySQL/assets/116119822/2c2fe8b2-aba7-4fb0-bc48-6899135c5613" width="20" height="20"/> Lab7
<h3 align="center">
  <a href="#client"></a>
  7.1 Создать транзакцию, произвести ее откат и фиксацию. Показать, что данные существовали до отката, удалились после отката, снова были добавлены, и затем были успешно зафиксированы.
</h3>

```mysql
-- Начинаем транзакцию
START TRANSACTION;

-- Добавляем нового клиента
INSERT INTO Client (id_client, full_name, passport, phone)
VALUES (12, 'Иван Иванович Иванов', '45 59 597152', '79101337228');

-- Создаем точку сохранения
SAVEPOINT savepoint1;

-- Добавляем еще одного клиента
INSERT INTO Client (id_client, full_name, passport, phone)
VALUES (13, 'Петр Петрович Петров', '98 76 543210', '79102281337');

-- Откатываем транзакцию до точки сохранения
ROLLBACK TO savepoint1;

-- Проверяем, что данные второго клиента были удалены после отката
SELECT * FROM Client WHERE id_client IN (12, 13);
```

| id\_client | full\_name | passport | phone |
| :--- | :--- | :--- | :--- |
| 12 | Иван Иванович Иванов | 45 59 597152 | 79101337228 |


```mysql
-- Снова добавляем второго клиента
INSERT INTO Client (id_client, full_name, passport, phone)
VALUES (13, 'Петр Петрович Петров', '98 76 543210', '79102281337');

-- Фиксируем транзакцию
COMMIT;

-- Проверяем, что данные обоих клиентов были успешно зафиксированы
SELECT * FROM Client WHERE client.id_client IN (12, 13);
```

| id\_client | full\_name | passport | phone |
| :--- | :--- | :--- | :--- |
| 12 | Иван Иванович Иванов | 45 59 597152 | 79101337228 |
| 13 | Петр Петрович Петров | 98 76 543210 | 79102281337 |
 

<h3 align="center">
  <a href="#client"></a>
  7.2 Подготовить SQL-скрипты для выполнения проверок изолированности транзакций.
</h3>

Далее для участков кода я буду приводить префикс-теги:  
1) ```#___1___#``` исполняется на первом пользователе
2) ```#___2___#``` исполняется на втором пользователе
3) ```#___1___# + #___2___#``` исполняется и там, и там, независимо от порядка выполнения 

### READ UNCOMMITTED

```mysql
-- 2. Установить в обоих сеансах уровень изоляции READ UNCOMMITTED
#___1___# + #___2___#
SET SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;
```

```mysql
-- Потерянные изменения
# Начинаем транзакцию и обновляем поле `full_name` в таблице `Client`. Если в другом окне выполнить
# запрос `UPDATE`, то изменения данной транзакции могут быть перезаписаны,
# что приведет к потере изменений после фиксации (`COMMIT`).
#___1___#
START TRANSACTION;
UPDATE Client SET full_name = 'Name From First Transaction' WHERE id_client = 13;
#___2___#
START TRANSACTION;
UPDATE Client SET full_name = 'Name From Second Transaction' WHERE id_client = 13;
COMMIT;
#___1___#
COMMIT;
```

| id\_client | full\_name | passport | phone |
| :--- | :--- | :--- | :--- |
| 13 | Name From Second Transaction | 98 76 543210 | 79102281337 |

```mysql
-- Грязное чтение
# Начинаем транзакцию и обновляем поле `full_name` в таблице `Client`. Если в другом окне выполнить
# запрос `SELECT` для чтения измененных данных до того, как мы зафиксируем или откатим транзакцию,
# то оно прочитает незафиксированные данные, что является грязным чтением.
#___1___#
START TRANSACTION;
UPDATE Client SET full_name = 'Dirty Read' WHERE id_client = 13;
#___2___#
SELECT * FROM Client WHERE id_client = 13;
#___1___#
ROLLBACK;
```

| id\_client | full\_name | passport | phone |
| :--- | :--- | :--- | :--- |
| 13 | Dirty Read | 98 76 543210 | 79102281337 |

### READ COMMITTED

```mysql
-- 4. Установить в обоих сеансах уровень изоляции READ COMMITTED
#___1___# + #___2___#
SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;
```

```mysql
-- Грязное чтение
# Повторим предыдущий сценарий и увидим, что грязное чтение больше не происходит
#___1___#
START TRANSACTION;
UPDATE Client SET full_name = 'Dirty Read' WHERE id_client = 13;
#___2___#
SELECT * FROM Client WHERE id_client = 13;
#___1___#
ROLLBACK;
```

| id\_client | full\_name | passport | phone |
| :--- | :--- | :--- | :--- |
| 13 | Name From Second Transaction | 98 76 543210 | 79102281337 |

```mysql
-- Неповторяющееся чтение
# Начинаем транзакцию и выполняем запрос `SELECT` из таблицы `Client`.
# Если в другом окне выполнить запрос `UPDATE`, затем повторить запрос `SELECT` в первом окне,
# то увидим, что данные изменились в течение одной и той же транзакции, что является неповторяющимся чтением.
#___1___#
START TRANSACTION;
SELECT * FROM Client WHERE id_client = 13; #(1)
#___2___#
START TRANSACTION;
UPDATE Client SET full_name = 'Changed Name' WHERE id_client = 13;
COMMIT;
#___1___#
SELECT * FROM Client WHERE id_client = 13; #(2)
COMMIT;
```

При первом SELECT(1):
| id\_client | full\_name | passport | phone |
| :--- | :--- | :--- | :--- |
| 13 | Name From Second Transaction | 98 76 543210 | 79102281337 |

При втором SELECT(2):
| id\_client | full\_name | passport | phone |
| :--- | :--- | :--- | :--- |
| 13 | Changed Name | 98 76 543210 | 79102281337 |

### REPEATABLE READ

```mysql
-- 6. Установить в обоих сеансах уровень изоляции REPEATABLE READ
#___1___# + #___2___#
SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;
```

```mysql
-- Неповторяющееся чтение
# Повторим предыдущий сценарий и увидим, что неповторяющееся чтение больше не происходит
#___1___#
START TRANSACTION;
SELECT * FROM Client WHERE id_client = 13; #(1)
#___2___#
START TRANSACTION;
UPDATE Client SET full_name = 'Changed Name' WHERE id_client = 13;
COMMIT;
#___1___#
SELECT * FROM Client WHERE id_client = 13; #(2)
COMMIT;
```

При первом SELECT(1):
| id\_client | full\_name | passport | phone |
| :--- | :--- | :--- | :--- |
| 13 | Standart Name | 98 76 543210 | 79102281337 |

При втором SELECT(2):
| id\_client | full\_name | passport | phone |
| :--- | :--- | :--- | :--- |
| 13 | Standart Name | 98 76 543210 | 79102281337 |

По поводу фантомных чтений: в MySQL на уровне изоляции `REPEATABLE READ` проблема фантомных чтений неактуальна. И в PostgreSQL от них тоже избавились для данного уровня. 
Хотя в классическом представлении этого уровня, мы должны наблюдать этот эффект(например, в MS SQL он присутствует).
Подробнее:
[REPEATABLE READ in MySQL](https://www.linkedin.com/pulse/db-isolation-levels-part-2-repeatable-read-tushar-goel#:~:text=In%20simple%20terms%2C%20a%20phantom%20read%20happens%20when%20the%20same%20query%20run%20twice%20within%20a%20transaction%20sees%20different%20results.%20MySQL%20avoids%20phantom%20rows%20in%20the%20Repeatable%20Read%20isolation%20level "Вырезка про repeatable read")

Однако, все равно попытаемся:
```mysql
-- Фантомное чтение
#___1___#
START TRANSACTION;
SELECT * FROM Client WHERE id_client > 10; #(1)
#___2___#
START TRANSACTION;
INSERT INTO Client (id_client, full_name, passport, phone)
VALUE (14, 'Test', '45 58 597152', '79151337228');
COMMIT;
#___1___#
SELECT * FROM Client WHERE id_client > 10; #(2)
COMMIT;
```

При первом SELECT(1):
| id\_client | full\_name | passport | phone |
| :--- | :--- | :--- | :--- |
| 11 | Александр Романович Невский | 22 83 155478 | +79761234567 |
| 12 | Иван Иванович Иванов | 45 59 597152 | 79101337228 |
| 13 | Changed Name | 98 76 543210 | 79102281337 |

При первом SELECT(2):
| id\_client | full\_name | passport | phone |
| :--- | :--- | :--- | :--- |
| 11 | Александр Романович Невский | 22 83 155478 | +79761234567 |
| 12 | Иван Иванович Иванов | 45 59 597152 | 79101337228 |
| 13 | Changed Name | 98 76 543210 | 79102281337 |

Как можем заметить, фантомных строк нет.

### SERIALIZABLE

`Serializable` - это самый сильный уровень изоляции, он также предотвращает все нарушения, но оказывает наибольшее влияние на производительность сервера MySQL. 
Этот режим работает точно так же, как `REPEATABLE READ`, но неявно создает общую блокировку для всех SELECT операторов, независимо от того, используете вы их FOR SHARE(блокировка данных для других сеансов, пока текущий сеанс не завершит работу с ними) или нет. 
Однако, из-за чрезмерного использования блокировок существует больший риск возникновения взаимоблокировок, когда две или более транзакции ждут освобождения других блокировок.


